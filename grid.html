<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>基础数据</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font: 12px Arial, Helvetica, sans-serif;
        }
        table.dataTable td {
            text-align: center;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.12.0/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.12.0/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/fixedheader/3.2.3/css/fixedHeader.dataTables.min.css">
    <script src="https://cdn.datatables.net/fixedheader/3.2.3/js/dataTables.fixedHeader.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/fixedcolumns/4.1.0/css/fixedColumns.dataTables.min.css">
    <script src="https://cdn.datatables.net/fixedcolumns/4.1.0/js/dataTables.fixedColumns.min.js"></script>
    <script src="js/common.js"></script>
    <script>
        var labels = {
            "date": "日期",
            // "link": "链接",
            "confirm": "确诊",
            "wzz": "无症状",
            "zhuangui": "转归",
            "confirm_bihuan": "隔离管控确诊",
            "wzz_bihuan": "隔离管控无症状",
            "death": "死亡新增",
            "curr_confirm": "在院治疗",
            "cured": "新增治愈",
            "total_cured": "累计治愈",
            "curr_heavy": "现有重症",
            "curr_cri": "现有危重",
            "total": "阳性",
            "confirm_shaicha": "风险排查确诊",
            "wzz_shaicha": "风险排查无症状",
            "bihuan": "隔离管控",
            "shaicha": "风险排查",
            "history_total_cured": "历史累计治愈",
            "confirm-wzz_percent": "确诊/无症状比例",
            "wzz-zhuangui_percent": "无症状转归比例",
            "total_confirm": "累计确诊",
            "total_wzz": "累计无症状",
            "total_zhuangui": "累积转归",
            "total_wzz_correct": "累积无症状（去除转归）",
            "total_death": "累计死亡",
        };

        var dataColumns = [
            'confirm',
            'wzz',
            'zhuangui',
            'confirm_bihuan',
            'wzz_bihuan',
            'confirm_shaicha',
            'wzz_shaicha',
            'curr_confirm',
            'curr_heavy',
            'curr_cri',
            'cured',
            'total_cured',
            'death',
            'bihuan',
            'shaicha',
            'confirm-wzz_percent',
            'wzz-zhuangui_percent',
            'total_confirm',
            'total_wzz',
            'total_zhuangui',
            'total_wzz_correct',
            'total',
            'total_death',
            'history_total_cured',
        ];

        function init() {
            fetch(`data/dailyTotal.json`)
                .then(response => response.json())
                .then(data => {
                    renderUI(extendCalcData(data));
                });
        }

        function renderUI(data) {
            renderTable(data);
        }

        function renderTable(data) {
            var html = `<table id="covidData" class="dataTable display cell-border compact hover nowrap row-border"><thead><tr>`;
            html += `<th>${labels['date']}</th>`;
            dataColumns.forEach((key) => {
               html += `<th>${labels[key]}</th>`;
            });

            html += `</tr></thead><tbody>`;
            Object.entries(data.daily).forEach(([date, dailyData]) => {
                var row = `<tr>`;
                row += `<td>${date}</td>`;
                dataColumns.forEach((key) => {
                    row += `<td>${dailyData[key] !== undefined ? dailyData[key] : 'n/a'}</td>`;
                });
                row += `</tr>`;
                html += row;
            });
            html += `</tbody></table>`;
            $('#container').html(html);
            $('#covidData').DataTable({
                fixedHeader: true,
                fixedColumns: true,
                paging: false,
                searching: false,
                ordering:  false,
            });
        }
    </script>
</head>
<body onload="init()">
<div id="container"></div>
</body>
</html>