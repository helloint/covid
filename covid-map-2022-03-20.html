<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="https://api.map.baidu.com/api?type=webgl&v=1.0&ak=FOghoenHAy69lWj3HgkVW5kz4IRgbQSi"></script>
    <title>上海疫情地图</title>
    <style>
        body,html{width: 100%;height: 100%;padding: 0;margin: 0;}
        #container{width: 100%;height: 100%;overflow: hidden;}
        #container .BMapLabel {display: none !important;}
        .show-maptip #container .BMapLabel {display: block !important;}
        #title {color: red; position: fixed; top: 10px; left: 50%; transform: translate(-50%, 0);text-shadow: 2px 2px 4px #fff;border: 2px solid red; border-radius: 4px; padding: 0px 4px;}
    </style>
</head>
<body>
<div id='container'></div>
<div id='points'></div>
<div id='title'></div>
<script>
    var map = new BMapGL.Map('container');
    map.centerAndZoom(new BMapGL.Point(121.5,31.23), 12);
    map.enableScrollWheelZoom(true);
    var myGeo = new BMapGL.Geocoder();
    function mark(addresses) {
        addresses.forEach((address) => {
            myGeo.getPoint(address, function(point) {
                if (point) {
                    var marker = new BMapGL.Marker(new BMapGL.Point(point.lng, point.lat));
                    marker.setIcon(new BMapGL.Icon('icon.svg',
                        new BMapGL.Size(15, 15)
                    ));
                    var label = new BMapGL.Label(address, {offset:new BMapGL.Size(address.length * -5,-35)});
                    marker.setLabel(label);
                    map.addOverlay(marker);
                }
            }, "上海市");
        });
    }
    map.addEventListener('click', function (e) {
        console.log(`['', ${e.point.lng}, ${e.point.lat}],`);
    });
    map.addEventListener("zoomend", function () {
        //这里根据缩放显示和隐藏文本
        var currentZoom = this.getZoom();
        console.log(`currentZoom: ${currentZoom}`);
        document.body.className = currentZoom<=13?'':'show-maptip';
    });
    function fetchData(date) {
        fetch(`data/${date}.json`)
            .then(response => response.json())
            .then(json => mark(json))
            .then(() => {
                document.getElementById('title').innerText = date;
            });
    }
    function playData() {
        // from 3/6 to currentData
    }
    var currentData = '2022-03-20';
    fetchData(currentData);
    </script>
</body>
</html>